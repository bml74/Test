{% extends 'base/base_with_sidebar.html' %}
{% load crispy_forms_tags %}
{% load static %}
{% load humanize %}
{% block title %}Profile | {{ user.username }}{% endblock title %}



{% block main_content_container %}

<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

                <div class="row mb-4">
                    <div class="col-lg-12">
                        <div class="bg-lin-grad rounded shadow-sm p-5 rounded">
                            <h1 class="fw-bold">My profile</h1>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
<div class="col-lg-12">
  <div class="card">
    <div class="card-body">
      
      <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <fieldset class="form-group">
            <legend class="border-bottom mb-4">Profile Info</legend>
            {{ u_form|crispy }}
            {{ p_form|crispy }}
        </fieldset>
        <div class="form-group">
            <button class="w-100 btn btn-lg btn-outline-navy mt-3" type="submit" id="create-or-update">Update</button>
        </div>
    </form>
    
    </div>
  </div>

</div>                  
                          
                </div>
              



{% endblock main_content_container %}

{% block JavaScript %}
<!-- Include the Quill library -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<!-- Initialize Quill editor -->
<script>

    window.onload = function() {
        var newNode = document.createElement('div');
        newNode.id = 'quill_editor'; // editor-container
        var newInputNode = document.createElement('div');
        newInputNode.setAttribute("type", "hidden");
        newInputNode.setAttribute("name", "description");
        newInputNode.id = 'quill_descr';


        // Get the reference node
        var referenceNode = document.querySelector('#id_description.textarea.form-control'); // Description textarea

        // Insert the new node before the reference node
        referenceNode.after(newNode); 

        newNode.after(newInputNode);


        
        let toolbarOptions = [
        [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
        ['bold', 'italic', 'underline', 'strike'],        // toggled buttons
        ['link', 'image'],
        ['blockquote', 'code-block'],
        [{ 'header': 1 }, { 'header': 2 }],               // custom button values
        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
        [{ 'script': 'sub'}, { 'script': 'super' }],      // superscript/subscript
        [{ 'indent': '-1'}, { 'indent': '+1' }],          // outdent/indent                                       // remove formatting button
        [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme
        [{ 'font': [] }],
        [{ 'align': [] }],
        ];

    let quill = new Quill('#quill_editor', {
    modules: {
      toolbar: toolbarOptions
    },
    placeholder: 'Compose an epic...',
    theme: 'snow'
    });
  
    txt = document.getElementById("id_description").value;
    console.log(txt);
    document.getElementById("id_description").style.display = 'none';
    document.querySelector(".ql-editor").innerHTML = txt;

    btn = document.getElementById("create-or-update");
    btn.addEventListener('mouseover', (event) => {
        console.log(quill.root.innerHTML);
        let descr = document.querySelector('#id_description[name=description]');
        descr.value = quill.root.innerHTML;
    });
  




    };

</script>


{% endblock JavaScript %}