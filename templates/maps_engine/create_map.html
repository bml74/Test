<html lang="en">
{% load static %}


    <head>

        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="apple-touch-icon" href="https://upload.wikimedia.org/wikipedia/commons/4/49/Flag_of_Free_France_%281940-1944%29_Cross_of_Lorraine_variant.svg" sizes="180x180">
        <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/4/49/Flag_of_Free_France_%281940-1944%29_Cross_of_Lorraine_variant.svg" sizes="32x32" type="image/png">
        <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/4/49/Flag_of_Free_France_%281940-1944%29_Cross_of_Lorraine_variant.svg" sizes="16x16" type="image/png">
        <link rel="manifest" href="">
        <link rel="mask-icon" href="https://upload.wikimedia.org/wikipedia/commons/4/49/Flag_of_Free_France_%281940-1944%29_Cross_of_Lorraine_variant.svg" color="#712cf9">
        <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/4/49/Flag_of_Free_France_%281940-1944%29_Cross_of_Lorraine_variant.svg">
        <meta name="theme-color" content="#712cf9">
        <title>Create</title>
        <meta charset='utf-8' />
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <script src='https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js'></script>
        <link href='https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css' rel='stylesheet' />

        {% comment %} <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"> {% endcomment %}
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">

        <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
        <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>

        <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.css" type="text/css">
        <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.2/mapbox-gl-geocoder.css">

        <link rel="stylesheet" type="text/css" href="{% static 'maps/styles/yahad.css' %}">
        <style>


            .mapboxgl-popup-close-button { color: black; }
            .mapboxgl-popup-content { 
                font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif !important; 
                color: black; 
                border-radius: 10px; 
                border: 2px solid #214561 !important;
            }
            .mapboxgl-popup-content #popup-title { font-weight: 900 !important; color: black !important; }
            .mapboxgl-popup { width: 200px; }
            * {
                color: white;
            }
            input, select { color: black !important; }
            #console { border-radius: 10px; }


            @media (min-width: 768px) {
                #console { width: 360px!important; }
            }

            @media (max-width: 768px) {
                #console { width: 250px!important; }
            }
            .mapboxgl-ctrl-geocoder--suggestion-title, .mapboxgl-ctrl-geocoder--suggestion-address { color: black !important; }

            #main-img { width: 100%; height: auto; }
            .nav-link, .nav-link:hover { color: white; }
            .footer {
                position: absolute;
                bottom: 0px;
              }
        </style>

    </head>


    <body>

        <div id='map'></div>
        <div id='console' style="overflow-y: scroll !important; height: 92% !important; background-color: #214561 !important;">
            <div class="py-1"></div>
            <strong><h2 style="font-size: 24px;">Create map</h2></strong>
            <div class="py-1"></div>
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">Map</button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="events-tab" data-bs-toggle="tab" data-bs-target="#events" type="button" role="tab" aria-controls="events" aria-selected="false">Events</button>
                </li>
            </ul>
              
              <!-- Tab panes -->
            <div class="tab-content">
                <div class="tab-pane active" id="home" role="tabpanel" aria-labelledby="home-tab" tabindex="0">

                    <div class="input-group mt-4">
                        <span class="input-group-text" id="map-title">Main image</span>
                        <input type="text" placeholder="Paste URL" class="form-control" id="mapTitle" aria-label="Title" aria-describedby="map-title">
                    </div>

                    <div class="input-group mt-4">
                        <span class="input-group-text" id="map-title">Title</span>
                        <input type="text" value="The Holocaust by Bullets" class="form-control" id="mapTitle" aria-label="Title" aria-describedby="map-title">
                    </div>
        
                    <div class="input-group mt-4">
                        <span class="input-group-text">Description</span>
                        <textarea rows="4" class="form-control" aria-label="Description">Following Operation Barbarossa (the Nazi invasion of the Soviet Union), an estimated 2.2 million Jews were massacred in the U.S.S.R., primarily by Nazi mobile killing units, the Einsatzgruppen. The murderers rounded up the Jewish populations of the villages and towns they passed through, led them to the country-side and summarily executed them in shootings. The victims were buried (many of them still alive) in mass graves. Very little is known about these atrocities because there were so few survivors.</textarea>
                    </div>

                    <hr>    

                    <small class=""><strong>Details</strong></small>

                    <div class="py-2"></div>

                    <div class="session" id="meta-data">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" placeholder="Key" id="key">
                            <input type="text" class="form-control" placeholder="Value" aria-describedby="val">
                        </div>
                            <div class="">
                                <button class="btn btn-sm btn-outline-light w-100">Add more details <i class="fas fa-plus-circle"></i></button>
                            </div>

                    </div>

                    

                </div>
                <div class="tab-pane" id="events" role="tabpanel" aria-labelledby="events-tab" tabindex="0">
                    <div class="form-check">
                        <input checked class="form-check-input" type="radio" name="action-type" id="noAction" value="none" onclick="actionSelector(this);">
                        <label class="form-check-label" for="noAction">
                          No action
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="action-type" id="createEventByClick" value="click" onclick="actionSelector(this);">
                        <label class="form-check-label" for="createEventByClick">
                          Create event by click
                        </label> 
                    </div>

                    <div class="session" id="added-events"></div>

                </div>
            </div>

            <div class="footer">
                <button class="btn btn-lg btn-outline-light w-100 mb-4">Publish <i class="fas fa-check-circle"></i></button>
            </div>


            
            


            


            
            


            

        </div>

        <script src="{% static 'maps/scripts/get_access_token.js' %}"></script>
        <script src="{% static 'maps/scripts/geocoder.js' %}"></script>
        <script src="{% static 'maps/scripts/reverse_geocoder.js' %}"></script>
        <script src="{% static 'maps/scripts/geocoder_search.js' %}"></script>
        <script src="{% static 'maps/scripts/get_long_and_lat.js' %}"></script>
        <script src="{% static 'maps/scripts/get_click_loc.js' %}"></script>

        <!-- Load the `mapbox-gl-geocoder` plugin. -->
        <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.min.js"></script>

        <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.2/mapbox-gl-geocoder.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>

        <!-- moment.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>



        <script>

            // https://www.w3schools.com/jsref/jsref_obj_date.asp // DATES

            mapboxgl.accessToken = getMapboxAccessToken(); 'pk.eyJ1IjoiYm1sNzQiLCJhIjoiY2t6cmN5djB2NnJuMjJzdHZhYmRoeTltNCJ9.AW3ZM0ZGP8tXwWDbri969Q';

            const map = new mapboxgl.Map({
            container: 'map', // container element id
            style: 'mapbox://styles/mapbox/light-v10',
            // center: [-74.0059, 40.7128], // initial map center in [lon, lat]
            center: [30.4492, 50.4713],
            zoom: 4,
            minZoom: 2,
            renderWorldCopies: false
            });

            function addLayer (my_filter) {

                map.addLayer({
                id: 'collisions',
                type: 'circle',
                source: {
                    type: 'geojson',
                    data: "{% static 'maps/yahad.geojson'|safe %}" // Data source
                },

                paint: {

                    "circle-radius": [
                        'case', 
                        mag1, 4,
                        mag2, 6,
                        mag3, 8,
                        mag4, 10,
                        12 // Other (like an "else" statement)
                        ],


                    'circle-color': [ // IF DATA AVAILABLE
                    'match',
                    ['get', 'Content_Online'],
                    1, '#EC0C0C', // If content is online (i.e., if Yahad Map dot is red)
                    0, '#0CC2EC', // If content is not yet available online (i.e., if Yahad Map dot is red)
                    '#ccc'
                    ],
                    'circle-opacity': 0.8
                },

                
                });
            };

            function getCoordinates(e) {
                getClickLocation(e); // Get click position and log.
                coords = getLongitudeAndLatitude(e); // Get longitude and latitude. Returns array in form [lng, lat]
                lng = coords[0]; lat = coords[1]; 
                console.log(`Longitude: ${lng} | Latitude: ${lat}`)
                return {"longitude": lng, "latitude": lat};
            }

            function createMarker(lng, lat) {
                newMarker = new mapboxgl.Marker()
                .setLngLat([lng, lat])
                .addTo(map);
            }

            let click_selected = false; // Flag variable
            let num_events = 0; // Counter/iterator variable

            function actionSelector(myRadio) { // Upon radio selection
                if (myRadio.value != 'click') { // If not choosing click.
                    click_selected = false;
                    map.on('click', function (e) {
                        console.log("No action.")
                    });
                }
                else { // If choose to click to create event
                    click_selected = true;
                    map.on('click', function (e) {
                        if (click_selected) {
                            num_events += 1;
                            coords = getCoordinates(e); // Get coordinates
                            createMarker(coords.longitude, coords.latitude); // Create marker
                            newDiv = document.createElement("div");
                            newDiv.classList.add("input-group"); newDiv.classList.add("mb-3"); newDiv.id = `event-${num_events}`;
                            newLongitude = document.createElement("input"); newLongitude.classList.add("form-control"); newLongitude.value = coords.longitude; newLongitude.disabled = true;
                            newLatitude = document.createElement("input"); newLatitude.classList.add("form-control"); newLatitude.setAttribute("aria-describedby", "lat"); newLatitude.value = coords.latitude; newLatitude.disabled = true;
                            newDiv.appendChild(newLongitude);
                            newDiv.appendChild(newLatitude);
                            document.getElementById("added-events").appendChild(newDiv);    
                        }
                    });
                }
            }

            // Add the geocoder search bar to the map (default in top right of map).
            geocoder_search_engine(); 

        </script>



        



    </body>
</html>
